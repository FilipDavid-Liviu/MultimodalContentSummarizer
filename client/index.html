<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CAPLAN: SENSE Stage (Real Calibration)</title>
    <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
    <script src="js/gazeTracker.js"></script>
    <script src="js/bluetooth.js"></script>
    <script src="js/dataCollector.js"></script>
    <script src="js/apiClient.js"></script>
    <script src="js/app.js"></script>
    <style>
        body { font-family: 'Georgia', serif; line-height: 1.6; margin: 0; padding: 0; }
        
        /* The Reading Area */
        #content-container {
            max-width: 800px;
            margin: 50px auto;
            display: none; 
        }
        
        /* Huge padding for easier hits */
        p {
            padding: 60px;       
            margin-bottom: 120px; 
            background-color: #f9f9f9; 
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .active-aoi { 
            background-color: #e0f7fa; 
            border-color: #00acc1;
            transform: scale(1.02); 
        }

        /* Calibration UI */
        #calibration-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #f0f0f0; z-index: 100; text-align: center; padding-top: 10%;
        }
        .cal-point {
            width: 40px; height: 40px; background: red; border-radius: 50%;
            position: absolute; cursor: pointer; border: 3px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        
        /* Controls */
        #controls { position: fixed; top: 10px; right: 10px; z-index: 500; background: white; padding: 10px; border: 1px solid #ccc; }
        button { padding: 10px; cursor: pointer; font-weight: bold; margin-bottom: 5px; display: block; width: 100%; }
        #debug-indicator { color: red; font-weight: bold; font-size: 12px; margin-bottom: 5px; display: none; }
    </style>
</head>
<body>

    <div id="calibration-overlay">
        <h2>Calibration Phase</h2>
        <p>1. STARE at a red dot.<br>2. CLICK it 3-5 times while looking at it.<br>3. Do this for all 4 dots.</p>
        <div class="cal-point" style="top: 20%; left: 20%;"></div>
        <div class="cal-point" style="top: 20%; right: 20%;"></div>
        <div class="cal-point" style="bottom: 20%; left: 20%;"></div>
        <div class="cal-point" style="bottom: 20%; right: 20%;"></div>
        <button style="margin-top: 20px;">Finish & Start Reading</button>
    </div>

    <div id="controls">
        <div id="debug-indicator"> MOUSE DEBUG MODE ON</div>
        <div id="server-status">Server: Checking...</div>
        <div id="bluetooth-status">Bluetooth: Not connected</div>
        <button id="connect-bluetooth">Connect Polar Verity Sense</button>
        <button onclick="downloadCSV()">Download Logs (CSV)</button>
        <button onclick="testWindowSend()" style="background: #ff9800;">Test Send Window</button>
        <div id="heart-rate">Heart Rate: -- BPM</div>
        <div id="prediction">State: --</div>
        <div id="status">Points: 0</div>
        <div id="server-response"></div>
    </div>

    <div id="content-container">
        <h1>The History of Affective Computing</h1>
        <p id="p1">Paragraph 1: Affective computing is the study and development of systems and devices that can recognize, interpret, process, and simulate human affects. It is an interdisciplinary field spanning computer science, psychology, and cognitive science.</p>
        <p id="p2">Paragraph 2: The core ingenuity of the CAPLAN architecture lies in its minimalist approach, which effectively decouples the computationally intensive Machine Learning classification task from the client-side interaction.</p>
        <p id="p3">Paragraph 3: By executing the ANALYZE stage offline using a pre-trained Random Forest model derived from public datasets, the system dramatically reduces complexity and cost while leveraging validated research.</p>
        <p id="p4">Paragraph 4 (Hard): This section is intentionally complex. The Environmental Fixation Ratio (EFR) combined with concurrent interaction events allows the system to distinguish environmental Frustration from mere cognitive Confusion.</p>
    </div>

</body>
</html>

